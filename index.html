<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Esdiac â€” KMP Architecture v3</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --navy:   #091929; --navy2: #0E2338; --navy3: #163150;
  --blue:   #2D7DD2; --blue2: #4A90D9;
  --cyan:   #38C9E8; --white: #ECF4FC; --muted: #6A8FAD;
  --border: rgba(56,201,232,.18);
  --green:  #3DD68C; --orange:#FFAB4A; --purple:#9B72F5;
  --pink:   #F472B6; --red:   #F87171; --yellow:#FCD34D;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{
  background:var(--navy);color:var(--white);
  font-family:'Syne',sans-serif;min-height:100vh;overflow-x:hidden;
  background-image:
    radial-gradient(ellipse 70% 55% at 15% 0%,rgba(45,125,210,.1) 0%,transparent 65%),
    radial-gradient(ellipse 50% 40% at 85% 100%,rgba(56,201,232,.07) 0%,transparent 60%);
}
body::before{
  content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:
    linear-gradient(rgba(56,201,232,.025) 1px,transparent 1px),
    linear-gradient(90deg,rgba(56,201,232,.025) 1px,transparent 1px);
  background-size:48px 48px;
}

/* HEADER */
header{
  position:relative;z-index:10;padding:40px 60px 32px;
  border-bottom:1px solid var(--border);
  display:flex;align-items:flex-end;justify-content:space-between;
  background:rgba(9,25,41,.8);backdrop-filter:blur(14px);
}
.logo-wrap{display:flex;align-items:center;gap:18px}
.logo{
  width:52px;height:52px;border-radius:13px;
  background:linear-gradient(135deg,var(--blue) 0%,var(--cyan) 100%);
  display:grid;place-items:center;font-size:20px;font-weight:800;color:#fff;
  box-shadow:0 0 28px rgba(56,201,232,.5);
  animation:glow 3.5s ease infinite;
}
@keyframes glow{0%,100%{box-shadow:0 0 18px rgba(56,201,232,.35)}50%{box-shadow:0 0 42px rgba(56,201,232,.65)}}
h1{font-size:24px;font-weight:800;letter-spacing:-.5px;line-height:1}
h1 span{color:var(--cyan)}
.tagline{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--muted);margin-top:5px}
.badges{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
.badge{padding:5px 12px;border-radius:20px;font-size:11px;font-weight:600;letter-spacing:.5px;border:1px solid;font-family:'JetBrains Mono',monospace}
.bkmp  {color:var(--cyan);  border-color:rgba(56,201,232,.4);background:rgba(56,201,232,.07)}
.bcmp  {color:var(--green); border-color:rgba(61,214,140,.4);background:rgba(61,214,140,.07)}
.bmvvm {color:var(--orange);border-color:rgba(255,171,74,.4);background:rgba(255,171,74,.07)}
.bbuild{color:var(--purple);border-color:rgba(155,114,245,.4);background:rgba(155,114,245,.07)}
.bnobase{color:var(--yellow);border-color:rgba(252,211,77,.4);background:rgba(252,211,77,.07)}

/* TABS */
.tabs{
  display:flex;padding:0 60px;border-bottom:1px solid var(--border);
  background:rgba(9,25,41,.65);backdrop-filter:blur(10px);
  position:sticky;top:0;z-index:20;overflow-x:auto;
}
.tab{
  padding:14px 22px;background:none;border:none;
  font-family:'Syne',sans-serif;font-size:13px;font-weight:600;
  color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;
  transition:all .18s;white-space:nowrap;
}
.tab:hover{color:var(--white)}
.tab.on{color:var(--cyan);border-bottom-color:var(--cyan)}

/* PANELS */
.panel{display:none;padding:44px 60px;position:relative;z-index:1}
.panel.on{display:block}
@keyframes up{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
.panel.on>*{animation:up .3s ease both}
.panel.on>*:nth-child(2){animation-delay:.05s}
.panel.on>*:nth-child(3){animation-delay:.1s}
.panel.on>*:nth-child(4){animation-delay:.15s}

/* SECTION LABEL */
.sec{font-size:11px;font-weight:700;letter-spacing:3px;text-transform:uppercase;color:var(--cyan);margin-bottom:24px;display:flex;align-items:center;gap:12px}
.sec::after{content:'';flex:1;height:1px;background:var(--border)}

/* CALLOUT */
.callout{
  background:rgba(252,211,77,.06);border:1px solid rgba(252,211,77,.3);
  border-radius:12px;padding:16px 20px;margin-bottom:24px;
  display:flex;align-items:flex-start;gap:12px;font-size:13px;color:var(--white);line-height:1.6;
}
.callout-icon{font-size:18px;flex-shrink:0;margin-top:1px}

/* CARDS */
.card{background:rgba(14,35,56,.8);border:1px solid var(--border);border-radius:14px;padding:22px;backdrop-filter:blur(6px);transition:transform .2s,border-color .2s,box-shadow .2s}
.card:hover{transform:translateY(-2px);border-color:rgba(45,125,210,.5);box-shadow:0 10px 32px rgba(0,0,0,.35)}
.card-cat{font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;margin-bottom:8px}
.card-title{font-size:16px;font-weight:700;margin-bottom:6px}
.card-body{font-size:13px;color:var(--muted);line-height:1.65}

/* GRIDS */
.g2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.g3{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}

/* CODE */
.code{
  background:rgba(5,14,26,.95);border:1px solid rgba(56,201,232,.2);
  border-radius:12px;padding:22px 26px;font-family:'JetBrains Mono',monospace;
  font-size:12px;line-height:2;overflow-x:auto;margin-bottom:22px;
}
.kw {color:#9B72F5}.fn{color:#38C9E8}.str{color:#3DD68C}
.cm {color:#2e5070;font-style:italic}.ty{color:#FFAB4A}.nm{color:#F472B6}
.hi {color:#FCD34D;font-weight:600}   /* highlight */

/* COMPARISON GRID */
.cmp-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:28px}
.cmp-label{font-size:11px;font-weight:700;letter-spacing:1px;font-family:'JetBrains Mono',monospace;margin-bottom:10px;display:flex;align-items:center;gap:8px}

/* CLEAN ARCH LAYERS */
.layers{display:flex;flex-direction:column;gap:5px;max-width:860px;margin:0 auto 40px}
.layer{border-radius:12px;padding:15px 26px;display:flex;align-items:center;justify-content:space-between;border:1px solid;transition:all .18s;cursor:default}
.layer:hover{transform:scaleX(1.01)}
.ll{display:flex;align-items:center;gap:13px}
.l-icon{font-size:19px}
.l-name{font-size:14px;font-weight:700}
.l-sub{font-size:11px;color:var(--muted);margin-top:2px;font-family:'JetBrains Mono',monospace}
.l-tags{display:flex;gap:7px;flex-wrap:wrap;justify-content:flex-end}
.tag{padding:2px 9px;border-radius:5px;font-size:10px;font-family:'JetBrains Mono',monospace;font-weight:500}
.l-ui    {background:rgba(56,201,232,.07);border-color:rgba(56,201,232,.3)}.l-ui .l-name{color:var(--cyan)}.tag-ui{background:rgba(56,201,232,.12);color:var(--cyan)}
.l-pres  {background:rgba(155,114,245,.07);border-color:rgba(155,114,245,.3)}.l-pres .l-name{color:var(--purple)}.tag-pres{background:rgba(155,114,245,.12);color:var(--purple)}
.l-domain{background:rgba(61,214,140,.07);border-color:rgba(61,214,140,.3)}.l-domain .l-name{color:var(--green)}.tag-domain{background:rgba(61,214,140,.12);color:var(--green)}
.l-data  {background:rgba(255,171,74,.07);border-color:rgba(255,171,74,.3)}.l-data .l-name{color:var(--orange)}.tag-data{background:rgba(255,171,74,.12);color:var(--orange)}
.arrow-dn{text-align:center;color:var(--border);font-size:15px;margin:-1px 0}

/* MVVM FLOW */
.flow{display:flex;align-items:center;justify-content:center;gap:0;flex-wrap:nowrap;margin:24px 0 32px;overflow-x:auto;padding:12px}
.fnode{background:rgba(14,35,56,.9);border-radius:14px;padding:22px 18px;min-width:175px;text-align:center;border:1.5px solid;flex-shrink:0}
.fnode-icon{font-size:26px;margin-bottom:9px}
.fnode-title{font-size:13px;font-weight:700;margin-bottom:6px}
.fnode-items{font-size:11px;color:var(--muted);line-height:2;font-family:'JetBrains Mono',monospace}
.farrow{padding:0 12px;display:flex;flex-direction:column;align-items:center;gap:3px;flex-shrink:0}
.farrow span{font-size:17px;color:var(--blue)}
.farrow small{font-size:9px;color:var(--muted);white-space:nowrap;font-family:'JetBrains Mono',monospace}

/* NAV */
.nav-tree{display:flex;flex-direction:column;align-items:center}
.nn{background:rgba(14,35,56,.9);border:1.5px solid var(--border);border-radius:9px;padding:8px 15px;font-size:12px;font-weight:600;text-align:center;white-space:nowrap;min-width:85px;transition:all .18s;cursor:default}
.nn:hover{border-color:var(--blue);transform:scale(1.04);z-index:5;position:relative}
.nn-root{background:var(--blue);border-color:var(--cyan);color:#fff;font-size:14px;padding:10px 24px}
.nn-auth{border-color:rgba(255,171,74,.5);color:var(--orange)}
.nn-main{border-color:rgba(56,201,232,.5);color:var(--cyan);font-size:13px;padding:10px 18px}
.nn-tab{border-color:rgba(61,214,140,.4);color:var(--green)}
.nn-sub{border-color:var(--border);color:var(--muted);font-size:11px;padding:7px 11px}
.vl{width:1px;height:22px;background:var(--border);margin:0 auto}
.hrow{display:flex;justify-content:center;align-items:flex-start;gap:12px}
.branch{display:flex;flex-direction:column;align-items:center}

/* TREE */
.tree{background:rgba(5,14,26,.95);border:1px solid rgba(56,201,232,.2);border-radius:14px;padding:26px 30px;font-family:'JetBrains Mono',monospace;font-size:12px;line-height:2;overflow-x:auto}
.t-root{color:var(--cyan);font-weight:700;font-size:14px}
.t-bl{color:var(--purple);font-weight:600}
.t-app{color:var(--orange)}
.t-core{color:#9B72F5}
.t-feat{color:var(--blue2)}
.t-vm{color:var(--green);font-weight:600}
.t-plat{color:var(--pink)}
.t-cm{color:#2a4a6a;font-style:italic}
.t-plug{color:var(--orange)}

/* PLUGIN GRID */
.pg{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-bottom:24px}
.pc{background:rgba(14,35,56,.8);border:1px solid rgba(155,114,245,.25);border-radius:12px;padding:17px 19px}
.pc-name{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:500;color:var(--purple);margin-bottom:5px}
.pc-id{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--muted);background:rgba(155,114,245,.1);padding:2px 7px;border-radius:4px;display:inline-block;margin-bottom:8px}
.pc-desc{font-size:12px;color:var(--muted);line-height:1.55}
.pc-applies{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--cyan);margin-top:6px}

/* TECH GRID */
.tgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:13px}
.tc{background:rgba(14,35,56,.7);border:1px solid var(--border);border-radius:11px;padding:17px;transition:all .2s}
.tc:hover{border-color:rgba(45,125,210,.55);transform:translateY(-2px)}
.tc-cat{font-size:9px;font-weight:700;letter-spacing:2px;text-transform:uppercase;margin-bottom:6px}
.tc-name{font-size:14px;font-weight:700;margin-bottom:4px}
.tc-purpose{font-size:12px;color:var(--muted);line-height:1.55}
.tc-ver{font-family:'JetBrains Mono',monospace;font-size:10px;margin-top:6px;opacity:.5}

/* TABLE */
.tbl{width:100%;border-collapse:collapse;font-size:13px}
.tbl th{padding:12px 16px;text-align:left;color:var(--cyan);background:rgba(45,125,210,.15);border-bottom:1px solid var(--border)}
.tbl td{padding:12px 16px;border-bottom:1px solid rgba(56,201,232,.08);vertical-align:top}
.tbl tr:nth-child(even) td{background:rgba(56,201,232,.02)}
.tbl tr:hover td{background:rgba(45,125,210,.05)}
.tbl td:first-child{font-weight:700}
.mono{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--purple)}

/* FOOTER */
footer{position:relative;z-index:1;border-top:1px solid var(--border);padding:24px 60px;display:flex;justify-content:space-between;align-items:center;background:rgba(9,25,41,.6);font-size:11px;color:var(--muted);font-family:'JetBrains Mono',monospace}

@media(max-width:900px){
  header{padding:22px;flex-direction:column;gap:14px;align-items:flex-start}
  .tabs{padding:0 20px}
  .panel{padding:26px 20px}
  .g2,.g3,.cmp-grid,.pg{grid-template-columns:1fr}
  footer{flex-direction:column;gap:6px;text-align:center;padding:18px}
  .flow{flex-direction:column}
}
</style>
</head>
<body>

<header>
  <div class="logo-wrap">
    <div class="logo">E</div>
    <div>
      <h1>ESDIAC <span>Architecture</span></h1>
      <p class="tagline">// KMP Â· Compose MP Â· MVVM Â· Build-Logic Â· v2.0</p>
    </div>
  </div>
  <div class="badges">
    <span class="badge bkmp">KMP 2.1</span>
    <span class="badge bcmp">Compose MP</span>
    <span class="badge bmvvm">MVVM</span>
    <span class="badge bbuild">Build-Logic</span>
    <span class="badge bnobase">No Base Class</span>
  </div>
</header>

<nav class="tabs">
  <button class="tab on"  onclick="go('overview',this)">Overview</button>
  <button class="tab"     onclick="go('mvvm',this)">MVVM Pattern</button>
  <button class="tab"     onclick="go('buildlogic',this)">Build-Logic</button>
  <button class="tab"     onclick="go('modules',this)">Module Structure</button>
  <button class="tab"     onclick="go('layers',this)">Architecture Layers</button>
  <button class="tab"     onclick="go('nav',this)">Navigation</button>
  <button class="tab"     onclick="go('stack',this)">Tech Stack</button>
</nav>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• OVERVIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="p-overview" class="panel on">
 

  <p class="sec">Core Principles</p>
  <div class="g2" style="margin-bottom:32px">
    <div class="card"><div class="card-cat" style="color:var(--yellow)">MVVM â€” No Base Class</div><div class="card-title">Plain ViewModel()</div><div class="card-body">Each ViewModel extends <code style="font-family:'JetBrains Mono',monospace;background:rgba(255,171,74,.1);padding:1px 5px;border-radius:3px;font-size:11px">ViewModel()</code> directly. StateFlow and SharedFlow are declared as private properties. No shared base class, no hidden abstraction, fully readable in isolation.</div></div>
    <div class="card"><div class="card-cat" style="color:var(--purple)">Build-Logic</div><div class="card-title">Convention Plugins</div><div class="card-body">One included build, 6 plugins. Feature modules have ~10 lines of build config. <code style="font-family:'JetBrains Mono',monospace;background:rgba(155,114,245,.1);padding:1px 5px;border-radius:3px;font-size:11px">esdiac.kmp.feature</code> is the composite plugin â€” it brings in ViewModel, Koin, Decompose, and core modules automatically.</div></div>
    <div class="card"><div class="card-cat" style="color:var(--cyan)">Clean Architecture</div><div class="card-title">Three inward layers</div><div class="card-body">UI â†’ Presentation (ViewModel) â†’ Domain â†’ Data. The domain layer is pure Kotlin with zero platform imports, 100% testable in commonTest on both Android and iOS.</div></div>
    <div class="card"><div class="card-cat" style="color:var(--green)">KMP + Compose MP</div><div class="card-title">Maximum code reuse</div><div class="card-body">Business logic, UI, navigation, and ViewModel state live in commonMain. Only VoIP engine, push handlers, and eSIM provisioning use expect/actual for platform-specific code.</div></div>
  </div>

  <p class="sec">Feature Modules</p>
  <div class="g3">
    <div class="card" style="border-color:rgba(255,171,74,.3)"><div class="card-cat" style="color:var(--orange)">:feature:auth</div><div class="card-title" style="font-size:14px">Authentication</div><div class="card-body">Splash Â· GetStarted Â· Login Â· OTP Â· Register<br><span style="font-size:11px;color:var(--green);font-family:'JetBrains Mono',monospace">4 ViewModels â€” each self-contained</span></div></div>
    <div class="card" style="border-color:rgba(56,201,232,.3)"><div class="card-cat" style="color:var(--cyan)">:feature:home</div><div class="card-title" style="font-size:14px">Home Dashboard</div><div class="card-body">Transactions Â· Notifications Â· Promotions<br><span style="font-size:11px;color:var(--green);font-family:'JetBrains Mono',monospace">HomeViewModel</span></div></div>
    <div class="card" style="border-color:rgba(56,201,232,.3)"><div class="card-cat" style="color:var(--cyan)">:feature:call</div><div class="card-title" style="font-size:14px">VoIP Calling</div><div class="card-body">History Â· Contacts Â· Dialpad Â· Active Call<br><span style="font-size:11px;color:var(--green);font-family:'JetBrains Mono',monospace">4 ViewModels â€” each self-contained</span></div></div>
    <div class="card" style="border-color:rgba(61,214,140,.3)"><div class="card-cat" style="color:var(--green)">:feature:data-esim</div><div class="card-title" style="font-size:14px">eSIM Data</div><div class="card-body">Local Â· Regional Â· Global plans + detail + purchase<br><span style="font-size:11px;color:var(--green);font-family:'JetBrains Mono',monospace">EsimListViewModel, EsimDetailViewModel</span></div></div>
    <div class="card" style="border-color:rgba(61,214,140,.3)"><div class="card-cat" style="color:var(--green)">:feature:topup</div><div class="card-title" style="font-size:14px">Top-Up</div><div class="card-body">Mobile + Data: country â†’ carrier â†’ offer â†’ buy<br><span style="font-size:11px;color:var(--green);font-family:'JetBrains Mono',monospace">3 ViewModels, TopupType enum</span></div></div>
    <div class="card" style="border-color:rgba(255,171,74,.3)"><div class="card-cat" style="color:var(--orange)">:feature:pay</div><div class="card-title" style="font-size:14px">Esdiac Pay</div><div class="card-body">eGift: country â†’ category â†’ brands â†’ offers â†’ buy<br><span style="font-size:11px;color:var(--green);font-family:'JetBrains Mono',monospace">5 ViewModels in egift flow</span></div></div>
  </div>
</section>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• MVVM â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="p-mvvm" class="panel">
  <div class="callout">
    <span class="callout-icon">âœ…</span>
    <div><strong style="color:var(--yellow)">No BaseViewModel.</strong> Every ViewModel extends <code style="font-family:'JetBrains Mono',monospace;background:rgba(252,211,77,.12);padding:1px 6px;border-radius:3px">ViewModel()</code> directly from <code style="font-family:'JetBrains Mono',monospace;background:rgba(252,211,77,.12);padding:1px 6px;border-radius:3px">org.jetbrains.androidx.lifecycle</code>. State and events are declared as private properties inside each ViewModel â€” explicit, readable, and trivial to unit-test.</div>
  </div>

  <p class="sec">Data Flow</p>
  <div class="flow">
    <div class="fnode" style="border-color:rgba(56,201,232,.5)">
      <div class="fnode-icon">ğŸ–¥ï¸</div>
      <div class="fnode-title" style="color:var(--cyan)">Composable Screen</div>
      <div class="fnode-items">collectAsStateWithLifecycle()<br>LaunchedEffect(vm.uiEvent)<br>vm.someAction() calls</div>
    </div>
    <div class="farrow"><span>â‡„</span><small>StateFlow<br>+ actions</small></div>
    <div class="fnode" style="border-color:rgba(155,114,245,.5)">
      <div class="fnode-icon">âš™ï¸</div>
      <div class="fnode-title" style="color:var(--purple)">ViewModel : ViewModel()</div>
      <div class="fnode-items"><span style="color:var(--yellow)">private</span> _uiState: StateFlow<br><span style="color:var(--yellow)">private</span> _uiEvent: SharedFlow<br>viewModelScope.launch { }</div>
    </div>
    <div class="farrow"><span>â†’</span><small>suspend<br>invoke()</small></div>
    <div class="fnode" style="border-color:rgba(61,214,140,.5)">
      <div class="fnode-icon">ğŸ’</div>
      <div class="fnode-title" style="color:var(--green)">UseCase (Domain)</div>
      <div class="fnode-items">operator fun invoke()<br>Flow&lt;Resource&lt;T&gt;&gt;<br>Pure Kotlin â€” no platform</div>
    </div>
    <div class="farrow"><span>â†’</span><small>implements<br>interface</small></div>
    <div class="fnode" style="border-color:rgba(255,171,74,.5)">
      <div class="fnode-icon">ğŸ—„ï¸</div>
      <div class="fnode-title" style="color:var(--orange)">Repository (Data)</div>
      <div class="fnode-items">Ktor API call<br>SQLDelight cache<br>Resource wrapper</div>
    </div>
  </div>

  <p class="sec">The Pattern â€” consistent across all ViewModels</p>
  <div class="code">
<span class="cm">// Plain ViewModel â€” no base class, no shared abstraction</span>
<span class="kw">class</span> <span class="fn">EsimOfferViewModel</span>(
    <span class="kw">private val</span> <span class="nm">getOffersUseCase</span>: <span class="ty">GetEsimOffersUseCase</span>,
) : <span class="ty">ViewModel</span>() {

    <span class="cm">// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
    <span class="kw">private val</span> <span class="hi">_uiState</span> = <span class="fn">MutableStateFlow</span>(<span class="ty">EsimOfferUiState</span>())
    <span class="kw">val</span> <span class="nm">uiState</span>: <span class="ty">StateFlow</span>&lt;<span class="ty">EsimOfferUiState</span>&gt; = _uiState.asStateFlow()

    <span class="cm">// â”€â”€ Events â€” one-shot, not stored in state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
    <span class="kw">private val</span> <span class="hi">_uiEvent</span> = <span class="fn">MutableSharedFlow</span>&lt;<span class="ty">EsimOfferUiEvent</span>&gt;(extraBufferCapacity = <span class="ty">1</span>)
    <span class="kw">val</span> <span class="nm">uiEvent</span>: <span class="ty">SharedFlow</span>&lt;<span class="ty">EsimOfferUiEvent</span>&gt; = _uiEvent.asSharedFlow()

    <span class="cm">// â”€â”€ Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
    <span class="kw">fun</span> <span class="fn">loadOffers</span>(countryCode: <span class="ty">String</span>) {
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = <span class="ty">true</span>, error = <span class="kw">null</span>) }
            getOffersUseCase(countryCode).collect { resource ->
                <span class="kw">when</span> (resource) {
                    <span class="kw">is</span> <span class="ty">Resource.Success</span> -> _uiState.update {
                        it.copy(isLoading = <span class="ty">false</span>, offers = resource.data)
                    }
                    <span class="kw">is</span> <span class="ty">Resource.Error</span> -> {
                        _uiState.update { it.copy(isLoading = <span class="ty">false</span>, error = resource.message) }
                        _uiEvent.emit(<span class="ty">EsimOfferUiEvent.ShowNetworkError</span>)
                    }
                    <span class="ty">Resource.Loading</span> -> _uiState.update { it.copy(isLoading = <span class="ty">true</span>) }
                }
            }
        }
    }

    <span class="kw">fun</span> <span class="fn">onOfferSelected</span>(offerId: <span class="ty">String</span>) {
        viewModelScope.launch { _uiEvent.emit(<span class="ty">EsimOfferUiEvent.NavigateToDetail</span>(offerId)) }
    }
}
  </div>

  <p class="sec">State & Event types</p>
  <div class="g2" style="margin-bottom:24px">
    <div>
      <p style="font-size:11px;color:var(--muted);margin-bottom:10px;font-family:'JetBrains Mono',monospace">UiState â€” immutable data class</p>
      <div class="code" style="margin-bottom:0">
<span class="kw">data class</span> <span class="fn">EsimOfferUiState</span>(
    <span class="kw">val</span> <span class="nm">isLoading</span>: <span class="ty">Boolean</span>       = <span class="ty">true</span>,
    <span class="kw">val</span> <span class="nm">offers</span>: <span class="ty">List</span>&lt;<span class="ty">EsimOffer</span>&gt;  = emptyList(),
    <span class="kw">val</span> <span class="nm">error</span>: <span class="ty">String?</span>          = <span class="kw">null</span>,
)
<span class="cm">// No marker interface needed â€” just a data class</span>
      </div>
    </div>
    <div>
      <p style="font-size:11px;color:var(--muted);margin-bottom:10px;font-family:'JetBrains Mono',monospace">UiEvent â€” one-time sealed class</p>
      <div class="code" style="margin-bottom:0">
<span class="kw">sealed class</span> <span class="fn">EsimOfferUiEvent</span> {
    <span class="kw">data class</span> <span class="fn">NavigateToDetail</span>(
        <span class="kw">val</span> <span class="nm">offerId</span>: <span class="ty">String</span>
    ) : <span class="fn">EsimOfferUiEvent</span>()
    <span class="kw">data object</span> <span class="fn">ShowNetworkError</span> : <span class="fn">EsimOfferUiEvent</span>()
    <span class="kw">data object</span> <span class="fn">PurchaseSuccess</span>  : <span class="fn">EsimOfferUiEvent</span>()
}
      </div>
    </div>
  </div>

  <p class="sec">Composable Screen</p>
  <div class="code">
<span class="kw">@Composable</span>
<span class="kw">fun</span> <span class="fn">EsimOfferScreen</span>(
    <span class="nm">viewModel</span>: <span class="ty">EsimOfferViewModel</span> = <span class="fn">koinViewModel</span>(),
    <span class="nm">onNavigateToDetail</span>: (<span class="ty">String</span>) -> <span class="ty">Unit</span>,
) {
    <span class="kw">val</span> <span class="nm">uiState</span> <span class="kw">by</span> viewModel.uiState.<span class="fn">collectAsStateWithLifecycle</span>()

    <span class="fn">LaunchedEffect</span>(viewModel) {
        viewModel.uiEvent.<span class="fn">collect</span> { event ->
            <span class="kw">when</span> (event) {
                <span class="kw">is</span> <span class="ty">EsimOfferUiEvent.NavigateToDetail</span> -> <span class="fn">onNavigateToDetail</span>(event.offerId)
                <span class="ty">EsimOfferUiEvent.ShowNetworkError</span>    -> { <span class="cm">/* show snackbar */</span> }
                <span class="ty">EsimOfferUiEvent.PurchaseSuccess</span>     -> { <span class="cm">/* show dialog */</span>  }
            }
        }
    }

    <span class="kw">when</span> {
        uiState.isLoading        -> <span class="fn">EsdiacLoadingIndicator</span>()
        uiState.error != <span class="kw">null</span>   -> <span class="fn">EsdiacErrorState</span>(uiState.error, retry = { viewModel.<span class="fn">loadOffers</span>(countryCode) })
        uiState.offers.isEmpty() -> <span class="fn">EsdiacEmptyState</span>(<span class="str">"No offers available"</span>)
        <span class="kw">else</span> -> <span class="fn">LazyColumn</span> {
            items(uiState.offers) { offer ->
                <span class="fn">EsdiacOfferTile</span>(offer, onClick = { viewModel.<span class="fn">onOfferSelected</span>(offer.id) })
            }
        }
    }
}
  </div>

  <p class="sec">Why no base class?</p>
  <div class="g2">
    <div class="card" style="border-color:rgba(61,214,140,.3)">
      <div class="card-cat" style="color:var(--green)">Readability</div>
      <div class="card-body">Opening any ViewModel shows exactly what state and events it manages. No hunting through a parent class to understand the contract.</div>
    </div>
    <div class="card" style="border-color:rgba(61,214,140,.3)">
      <div class="card-cat" style="color:var(--green)">Testability</div>
      <div class="card-body">No base class constructor arguments. Instantiate with a fake use case and assert on the StateFlow directly. Tests are 5â€“10 lines.</div>
    </div>
    <div class="card" style="border-color:rgba(61,214,140,.3)">
      <div class="card-cat" style="color:var(--green)">Flexibility</div>
      <div class="card-body">Each ViewModel structures its state however makes sense for that screen. No interface to satisfy, no overrides forced by a base class.</div>
    </div>
    <div class="card" style="border-color:rgba(61,214,140,.3)">
      <div class="card-cat" style="color:var(--green)">Idiomatic Kotlin</div>
      <div class="card-body">StateFlow + update{} and SharedFlow + emit() are already concise. A base class adds indirection without reducing boilerplate.</div>
    </div>
  </div>

  <p class="sec" style="margin-top:28px">Unit test â€” no setup overhead</p>
  <div class="code">
<span class="kw">class</span> <span class="fn">EsimOfferViewModelTest</span> {

    <span class="kw">@Test</span>
    <span class="kw">fun</span> <span class="fn">`loadOffers emits loading then success`</span>() = runTest {
        <span class="kw">val</span> <span class="nm">vm</span> = <span class="fn">EsimOfferViewModel</span>(<span class="fn">FakeGetEsimOffersUseCase</span>(listOf(plan1, plan2)))

        vm.uiState.test {
            assertTrue(awaitItem().isLoading)        <span class="cm">// initial state</span>
            vm.<span class="fn">loadOffers</span>(<span class="str">"US"</span>)
            <span class="kw">val</span> <span class="nm">loaded</span> = awaitItem()
            assertFalse(loaded.isLoading)
            assertEquals(<span class="ty">2</span>, loaded.offers.size)
            assertNull(loaded.error)
            cancelAndIgnoreRemainingEvents()
        }
    }

    <span class="kw">@Test</span>
    <span class="kw">fun</span> <span class="fn">`onOfferSelected emits NavigateToDetail event`</span>() = runTest {
        <span class="kw">val</span> <span class="nm">vm</span> = <span class="fn">EsimOfferViewModel</span>(<span class="fn">FakeGetEsimOffersUseCase</span>(emptyList()))
        vm.uiEvent.test {
            vm.<span class="fn">onOfferSelected</span>(<span class="str">"offer-123"</span>)
            assertEquals(<span class="fn">EsimOfferUiEvent.NavigateToDetail</span>(<span class="str">"offer-123"</span>), awaitItem())
            cancelAndIgnoreRemainingEvents()
        }
    }
}
  </div>
</section>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• BUILD-LOGIC â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="p-buildlogic" class="panel">
  <p class="sec">Convention Plugins</p>
  <div class="pg">
    <div class="pc">
      <div class="pc-name">EsdiacAndroidApplicationPlugin</div>
      <div class="pc-id">esdiac.android.application</div>
      <div class="pc-desc">compileSdk, minSdk, applicationId, signing config, ProGuard rules, Java 17.</div>
      <div class="pc-applies">â†’ android.application + kotlin.android</div>
    </div>
    <div class="pc">
      <div class="pc-name">EsdiacKmpLibraryPlugin</div>
      <div class="pc-id">esdiac.kmp.library</div>
      <div class="pc-desc">KMP targets (androidTarget + iosX64/iosArm64/iosSim), jvmTarget=17, framework baseName, coroutines.</div>
      <div class="pc-applies">â†’ kotlin.multiplatform + android.library</div>
    </div>
    <div class="pc">
      <div class="pc-name">EsdiacKmpComposePlugin</div>
      <div class="pc-id">esdiac.kmp.compose</div>
      <div class="pc-desc">Adds Compose MP + compose.compiler. Injects compose.ui, material3, resources, uiToolingPreview.</div>
      <div class="pc-applies">â†’ org.jetbrains.compose + kotlin.plugin.compose</div>
    </div>
    <div class="pc" style="border-color:rgba(61,214,140,.3)">
      <div class="pc-name" style="color:var(--green)">EsdiacKmpFeaturePlugin â­</div>
      <div class="pc-id" style="background:rgba(61,214,140,.1);color:var(--green)">esdiac.kmp.feature</div>
      <div class="pc-desc">Composite plugin for every feature module. Brings KMP + Compose + lifecycle-viewmodel + Decompose + Koin + core modules.</div>
      <div class="pc-applies">â†’ esdiac.kmp.library + esdiac.kmp.compose</div>
    </div>
    <div class="pc">
      <div class="pc-name">EsdiacAndroidLibraryPlugin</div>
      <div class="pc-id">esdiac.android.library</div>
      <div class="pc-desc">Pure Android modules (platform-only integrations). Sets compileSdk, namespace, ViewBinding.</div>
      <div class="pc-applies">â†’ android.library + kotlin.android</div>
    </div>
    <div class="pc">
      <div class="pc-name">EsdiacDetektPlugin</div>
      <div class="pc-id">esdiac.detekt</div>
      <div class="pc-desc">Detekt static analysis on all source sets. Shared detekt.yml baseline. Hooked into check task.</div>
      <div class="pc-applies">â†’ io.gitlab.arturbosch.detekt</div>
    </div>
  </div>

  <p class="sec">Before vs After</p>
  <div class="cmp-grid">
    <div>
      <div class="cmp-label"><span style="color:var(--red)">âœ—</span> Without convention plugins  (~55 lines)</div>
      <div class="code" style="border-color:rgba(248,113,113,.2)">
<span class="kw">plugins</span> {
  id(<span class="str">"org.jetbrains.kotlin.multiplatform"</span>)
  id(<span class="str">"com.android.library"</span>)
  id(<span class="str">"org.jetbrains.compose"</span>)
  id(<span class="str">"org.jetbrains.kotlin.plugin.compose"</span>)
  id(<span class="str">"org.jetbrains.kotlin.plugin.serialization"</span>)
}
<span class="kw">kotlin</span> {
  androidTarget { compilations.all {
    kotlinOptions { jvmTarget = <span class="str">"17"</span> } } }
  listOf(iosX64(), iosArm64(), iosSimulatorArm64())
    .forEach { it.binaries.framework { ... } }
  sourceSets.commonMain.dependencies {
    implementation(compose.ui)
    implementation(compose.material3)
    implementation(<span class="str">"io.insert-koin:koin-core:4.0.0"</span>)
    implementation(<span class="str">"com.arkivanov.decompose:decompose:3.1.0"</span>)
    implementation(<span class="str">"org.jetbrains.androidx.lifecycle:lifecycle-viewmodel:2.9.0"</span>)
    <span class="cm">// ... 10 more lines duplicated in EVERY module</span>
  }
}
android {
  compileSdk = <span class="ty">35</span>; namespace = <span class="str">"com.esdiac.esim"</span>
  defaultConfig { minSdk = <span class="ty">24</span> }
  compileOptions { ... }
}
      </div>
    </div>
    <div>
      <div class="cmp-label"><span style="color:var(--green)">âœ“</span> With convention plugins  (~10 lines)</div>
      <div class="code" style="border-color:rgba(61,214,140,.25)">
<span class="cm">// :feature:data-esim/build.gradle.kts</span>
<span class="kw">plugins</span> {
  alias(libs.plugins.<span class="fn">esdiac.kmp.feature</span>)    <span class="cm">// â† does everything above</span>
  alias(libs.plugins.<span class="fn">kotlin.serialization</span>)  <span class="cm">// DTOs</span>
  alias(libs.plugins.<span class="fn">esdiac.detekt</span>)         <span class="cm">// linting</span>
}
<span class="kw">kotlin</span> {
  sourceSets.commonMain.dependencies {
    <span class="cm">// only feature-specific extras:</span>
    implementation(project(<span class="str">":shared:core:core-network"</span>))
    implementation(project(<span class="str">":shared:core:core-database"</span>))
  }
}
      </div>
    </div>
  </div>
</section>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODULES â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="p-modules" class="panel">
  <p class="sec">Full Gradle Module Tree</p>
  <div class="tree">
<span class="t-root">esdiac/</span>
  â”œâ”€â”€ <span class="t-bl">build-logic/</span>                   <span class="t-cm">â† included build</span>
  â”‚     â””â”€â”€ convention/src/main/kotlin/
  â”‚           â”œâ”€â”€ <span class="t-plug">EsdiacAndroidApplicationPlugin.kt</span>
  â”‚           â”œâ”€â”€ <span class="t-plug">EsdiacKmpLibraryPlugin.kt</span>
  â”‚           â”œâ”€â”€ <span class="t-plug">EsdiacKmpComposePlugin.kt</span>
  â”‚           â”œâ”€â”€ <span class="t-plug">EsdiacKmpFeaturePlugin.kt</span>      <span class="t-cm">â† â­ composite plugin</span>
  â”‚           â””â”€â”€ <span class="t-plug">EsdiacDetektPlugin.kt</span>
  â”œâ”€â”€ gradle/libs.versions.toml          <span class="t-cm">â† single version catalog</span>
  â”œâ”€â”€ settings.gradle.kts                <span class="t-cm">â† includeBuild("build-logic")</span>
  â”œâ”€â”€ <span class="t-app">androidApp/</span>                    <span class="t-plug">plugins { esdiac.android.application }</span>
  â”‚     â””â”€â”€ EsdiacApplication.kt, MainActivity.kt
  â”œâ”€â”€ <span class="t-app">iosApp/</span>                        <span class="t-cm">â† Xcode â€” KoinKt.doInitKoin()</span>
  â””â”€â”€ <span class="t-core">shared/</span>
        â”œâ”€â”€ <span class="t-core">core/</span>
        â”‚     â”œâ”€â”€ <span class="t-core">core-ui</span>           <span class="t-plug">â†’ esdiac.kmp.library + esdiac.kmp.compose</span>
        â”‚     â”‚     â”œâ”€â”€ theme/         <span class="t-cm">EsdiacTheme, LightColors, DarkColors, Typography, Shapes</span>
        â”‚     â”‚     â””â”€â”€ components/    <span class="t-cm">EsdiacButton, EsdiacCard, EsdiacTopBar, etc.</span>
        â”‚     â”œâ”€â”€ <span class="t-core">core-network</span>       <span class="t-plug">â†’ esdiac.kmp.library + kotlin.serialization</span>
        â”‚     â”‚     â”œâ”€â”€ HttpClientFactory.kt
        â”‚     â”‚     â”œâ”€â”€ interceptors/  <span class="t-cm">Auth, Logging, Retry</span>
        â”‚     â”‚     â””â”€â”€ ApiResponse.kt <span class="t-cm">sealed: Loading | Success&lt;T&gt; | Error</span>
        â”‚     â”œâ”€â”€ <span class="t-core">core-database</span>      <span class="t-plug">â†’ esdiac.kmp.library + sqldelight</span>
        â”‚     â”‚     â”œâ”€â”€ EsdiacDatabase.sq
        â”‚     â”‚     â””â”€â”€ DatabaseDriverFactory.kt  <span class="t-cm">expect/actual</span>
        â”‚     â”œâ”€â”€ <span class="t-core">core-domain</span>        <span class="t-plug">â†’ esdiac.kmp.library</span>
        â”‚     â”‚     â”œâ”€â”€ Resource.kt    <span class="t-cm">sealed: Loading | Success&lt;T&gt; | Error</span>
        â”‚     â”‚     â”œâ”€â”€ UseCase.kt     <span class="t-cm">abstract suspend operator fun invoke</span>
        â”‚     â”‚     â””â”€â”€ FlowUseCase.kt <span class="t-cm">returns Flow&lt;Resource&lt;T&gt;&gt;</span>
        â”‚     â”‚     <span class="t-cm">NO BaseViewModel â€” ViewModels are self-contained per feature</span>
        â”‚     â”œâ”€â”€ <span class="t-core">core-navigation</span>    <span class="t-plug">â†’ esdiac.kmp.library</span>
        â”‚     â”‚     â”œâ”€â”€ RootComponent.kt
        â”‚     â”‚     â””â”€â”€ AppNavConfig.kt  <span class="t-cm">sealed: Auth | Main</span>
        â”‚     â””â”€â”€ <span class="t-core">core-di</span>            <span class="t-plug">â†’ esdiac.kmp.library</span>
        â”‚           â””â”€â”€ AppModule.kt    <span class="t-cm">initKoin â€” aggregates all feature modules</span>
        â””â”€â”€ <span class="t-feat">feature/</span>
              â”œâ”€â”€ <span class="t-feat">auth</span>               <span class="t-plug">â†’ esdiac.kmp.feature</span>
              â”‚     â”œâ”€â”€ domain/ { User, OtpCode, AuthToken, AuthRepository }
              â”‚     â”‚           { LoginUseCase, OtpVerifyUseCase, RegisterUseCase }
              â”‚     â”œâ”€â”€ data/   { AuthApiService, AuthDto, AuthMapper, AuthRepositoryImpl }
              â”‚     â””â”€â”€ presentation/
              â”‚           â”œâ”€â”€ AuthComponent.kt
              â”‚           â”œâ”€â”€ splash/     { SplashUiState Â· <span class="t-vm">SplashViewModel : ViewModel()</span> Â· SplashScreen }
              â”‚           â”œâ”€â”€ login/      { LoginUiState Â· LoginUiEvent Â· <span class="t-vm">LoginViewModel : ViewModel()</span> Â· LoginScreen }
              â”‚           â”œâ”€â”€ otp/        { OtpUiState Â· OtpUiEvent Â· <span class="t-vm">OtpViewModel : ViewModel()</span> Â· OtpScreen }
              â”‚           â””â”€â”€ register/   { RegisterUiState Â· RegisterUiEvent Â· <span class="t-vm">RegisterViewModel : ViewModel()</span> Â· RegisterScreen }
              â”œâ”€â”€ <span class="t-feat">home</span>               <span class="t-plug">â†’ esdiac.kmp.feature</span>
              â”‚     â””â”€â”€ presentation/ { HomeUiState Â· <span class="t-vm">HomeViewModel : ViewModel()</span> Â· HomeScreen }
              â”œâ”€â”€ <span class="t-feat">call</span>               <span class="t-plug">â†’ esdiac.kmp.feature</span>
              â”‚     â”œâ”€â”€ domain/ { CallRecord, Contact, VoipEngine(expect/actual) }
              â”‚     â””â”€â”€ presentation/
              â”‚           â”œâ”€â”€ CallComponent.kt
              â”‚           â”œâ”€â”€ history/    { CallHistoryUiState Â· <span class="t-vm">CallHistoryViewModel : ViewModel()</span> Â· CallHistoryScreen }
              â”‚           â”œâ”€â”€ contacts/   { ContactsUiState Â· <span class="t-vm">ContactsViewModel : ViewModel()</span> Â· ContactsScreen }
              â”‚           â”œâ”€â”€ dialpad/    { DialpadUiState Â· DialpadUiEvent Â· <span class="t-vm">DialpadViewModel : ViewModel()</span> Â· DialpadScreen }
              â”‚           â””â”€â”€ activecall/ { ActiveCallUiState Â· ActiveCallUiEvent Â· <span class="t-vm">ActiveCallViewModel : ViewModel()</span> Â· Screen }
              â”œâ”€â”€ <span class="t-feat">data-esim</span>          <span class="t-plug">â†’ esdiac.kmp.feature + kotlin.serialization</span>
              â”‚     â”œâ”€â”€ domain/ { EsimPlan, Country, Region, EsimRepository }
              â”‚     â””â”€â”€ presentation/
              â”‚           â”œâ”€â”€ EsimComponent.kt
              â”‚           â”œâ”€â”€ local/    { <span class="t-vm">EsimListViewModel(scope=LOCAL) : ViewModel()</span> Â· EsimLocalScreen }
              â”‚           â”œâ”€â”€ regional/ { <span class="t-vm">EsimListViewModel(scope=REGIONAL) : ViewModel()</span> Â· EsimRegionalScreen }
              â”‚           â”œâ”€â”€ global/   { <span class="t-vm">EsimListViewModel(scope=GLOBAL) : ViewModel()</span> Â· EsimGlobalScreen }
              â”‚           â””â”€â”€ detail/   { EsimDetailUiState Â· EsimDetailUiEvent Â· <span class="t-vm">EsimDetailViewModel : ViewModel()</span> Â· Screen }
              â”œâ”€â”€ <span class="t-feat">topup</span>              <span class="t-plug">â†’ esdiac.kmp.feature</span>
              â”‚     â””â”€â”€ presentation/  <span class="t-cm">TopupType.MOBILE | DATA â€” same UI, different endpoint</span>
              â”‚           â”œâ”€â”€ TopupComponent.kt
              â”‚           â”œâ”€â”€ country/ { CountryListUiState Â· <span class="t-vm">CountryListViewModel : ViewModel()</span> Â· Screen }
              â”‚           â”œâ”€â”€ carrier/ { CarrierListUiState Â· <span class="t-vm">CarrierListViewModel : ViewModel()</span> Â· Screen }
              â”‚           â””â”€â”€ detail/  { TopupDetailUiState Â· TopupDetailUiEvent Â· <span class="t-vm">TopupDetailViewModel : ViewModel()</span> Â· Screen }
              â”œâ”€â”€ <span class="t-feat">pay</span>                <span class="t-plug">â†’ esdiac.kmp.feature</span>
              â”‚     â””â”€â”€ presentation/egift/
              â”‚           â”œâ”€â”€ country/  { <span class="t-vm">EgiftCountryViewModel : ViewModel()</span> Â· Screen }
              â”‚           â”œâ”€â”€ category/ { <span class="t-vm">EgiftCategoryViewModel : ViewModel()</span> Â· Screen }
              â”‚           â”œâ”€â”€ brands/   { <span class="t-vm">EgiftBrandsViewModel : ViewModel()</span> Â· Screen }
              â”‚           â”œâ”€â”€ offers/   { <span class="t-vm">EgiftOffersViewModel : ViewModel()</span> Â· Screen }
              â”‚           â””â”€â”€ detail/   { EgiftDetailUiState Â· EgiftDetailUiEvent Â· <span class="t-vm">EgiftDetailViewModel : ViewModel()</span> Â· Screen }
              â””â”€â”€ <span class="t-feat">profile</span>            <span class="t-plug">â†’ esdiac.kmp.feature</span>
                    â””â”€â”€ presentation/ { ProfileUiState Â· ProfileUiEvent Â· <span class="t-vm">ProfileViewModel : ViewModel()</span> Â· Screen }

  <span class="t-plat">// expect/actual â€” shared/androidMain + iosMain</span>
  <span class="t-plat">// VoipEngineActual Â· DatabaseDriverActual Â· PushHandlerActual Â· ContactsProviderActual</span>
  </div>
</section>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• LAYERS â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="p-layers" class="panel">
  <p class="sec">Clean Architecture â€” per feature</p>
  <div class="layers">
    <div class="layer l-ui"><div class="ll"><span class="l-icon">ğŸ–¥ï¸</span><div><div class="l-name">UI Layer â€” Compose Multiplatform</div><div class="l-sub">@Composable screens Â· collectAsStateWithLifecycle() Â· LaunchedEffect(events)</div></div></div><div class="l-tags"><span class="tag tag-ui">Compose MP</span><span class="tag tag-ui">Material 3</span><span class="tag tag-ui">EsdiacTheme</span><span class="tag tag-ui">Coil 3</span></div></div>
    <div class="arrow-dn">â†“  collectAsStateWithLifecycle Â· vm.action()</div>
    <div class="layer l-pres"><div class="ll"><span class="l-icon">âš™ï¸</span><div><div class="l-name">Presentation â€” ViewModel : ViewModel()  (no base class)</div><div class="l-sub">private _uiState: StateFlow Â· private _uiEvent: SharedFlow Â· viewModelScope</div></div></div><div class="l-tags"><span class="tag tag-pres">lifecycle-viewmodel KMP</span><span class="tag tag-pres">Decompose retained</span><span class="tag tag-pres">Koin viewModel()</span></div></div>
    <div class="arrow-dn">â†“  useCase.invoke()</div>
    <div class="layer l-domain"><div class="ll"><span class="l-icon">ğŸ’</span><div><div class="l-name">Domain Layer â€” Pure Kotlin</div><div class="l-sub">Entities Â· Repository interfaces Â· Use Cases â€” zero platform imports</div></div></div><div class="l-tags"><span class="tag tag-domain">Pure Kotlin</span><span class="tag tag-domain">commonMain only</span><span class="tag tag-domain">100% unit testable</span></div></div>
    <div class="arrow-dn">â†“  implements interface</div>
    <div class="layer l-data"><div class="ll"><span class="l-icon">ğŸ—„ï¸</span><div><div class="l-name">Data Layer â€” Repository Implementations</div><div class="l-sub">Ktor remote Â· SQLDelight local Â· DTOâ†”Domain mappers Â· cache-first strategy</div></div></div><div class="l-tags"><span class="tag tag-data">Ktor 3</span><span class="tag tag-data">SQLDelight 2</span><span class="tag tag-data">Mappers</span><span class="tag tag-data">Cache-first</span></div></div>
  </div>

  <p class="sec">Feature Summary</p>
  <div style="overflow-x:auto">
  <table class="tbl">
    <thead><tr><th>Module</th><th>Plugin</th><th>ViewModels (all : ViewModel())</th><th>Domain</th></tr></thead>
    <tbody>
      <tr><td>:feature:auth</td><td class="mono">esdiac.kmp.feature</td><td style="color:var(--muted)">Splash, Login, Otp, Register</td><td style="color:var(--muted)">LoginUseCase, OtpVerifyUseCase, RegisterUseCase</td></tr>
      <tr><td>:feature:home</td><td class="mono">esdiac.kmp.feature</td><td style="color:var(--muted)">HomeViewModel</td><td style="color:var(--muted)">GetTransactionsUseCase, GetNotificationsUseCase</td></tr>
      <tr><td>:feature:call</td><td class="mono">esdiac.kmp.feature</td><td style="color:var(--muted)">CallHistory, Contacts, Dialpad, ActiveCall</td><td style="color:var(--muted)">InitCallUseCase, GetHistoryUseCase, VoipEngine(expect)</td></tr>
      <tr><td>:feature:data-esim</td><td class="mono">esdiac.kmp.feature + serialization</td><td style="color:var(--muted)">EsimList(Ã—3 scopes), EsimDetail</td><td style="color:var(--muted)">GetCountriesUseCase, GetEsimOffersUseCase, PurchaseEsimUseCase</td></tr>
      <tr><td>:feature:topup</td><td class="mono">esdiac.kmp.feature</td><td style="color:var(--muted)">CountryList, CarrierList, TopupDetail</td><td style="color:var(--muted)">MobileTopupUseCase, DataTopupUseCase</td></tr>
      <tr><td>:feature:pay</td><td class="mono">esdiac.kmp.feature</td><td style="color:var(--muted)">EgiftCountry, Category, Brands, Offers, Detail</td><td style="color:var(--muted)">GetBrandsUseCase, GetGiftCardsUseCase, PurchaseGiftCardUseCase</td></tr>
      <tr><td>:feature:profile</td><td class="mono">esdiac.kmp.feature</td><td style="color:var(--muted)">ProfileViewModel</td><td style="color:var(--muted)">UpdateProfileUseCase, SetThemeModeUseCase</td></tr>
    </tbody>
  </table>
  </div>
</section>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• NAV â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="p-nav" class="panel">
  <p class="sec">Decompose Navigation Tree</p>
  <div class="nav-tree">
    <div class="nn nn-root">RootComponent</div><div class="vl"></div>
    <div class="hrow">
      <div class="branch">
        <div class="nn nn-auth">AuthComponent</div><div class="vl"></div>
        <div style="display:flex;gap:7px;flex-wrap:wrap;justify-content:center">
          <div class="nn nn-sub">Splash</div><div class="nn nn-sub">GetStarted</div><div class="nn nn-sub">Login</div><div class="nn nn-sub">OTP</div><div class="nn nn-sub">Register</div>
        </div>
      </div>
      <div style="padding-top:18px;color:var(--border);font-size:22px;padding-inline:8px">Â·</div>
      <div class="branch">
        <div class="nn nn-main">MainComponent (BottomNav)</div><div class="vl"></div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;align-items:flex-start">
          <div class="branch"><div class="nn nn-tab" style="color:var(--muted)">Home</div><div class="vl"></div><div class="nn nn-sub">HomeScreen</div></div>
          <div class="branch">
            <div class="nn nn-tab" style="color:var(--cyan)">Call</div><div class="vl"></div>
            <div style="display:flex;gap:6px">
              <div class="nn nn-sub">History</div><div class="nn nn-sub">Contacts</div>
              <div class="nn nn-sub" style="color:var(--cyan);border-color:rgba(56,201,232,.5)">Dialpad â†—</div>
              <div class="nn nn-sub" style="color:var(--pink);border-color:rgba(244,114,182,.5)">ActiveCall</div>
            </div>
          </div>
          <div class="branch">
            <div class="nn nn-tab" style="color:var(--green)">Data eSIM</div><div class="vl"></div>
            <div style="display:flex;gap:8px;align-items:flex-start">
              <div class="branch"><div class="nn nn-sub">Local</div><div class="vl"></div><div class="nn nn-sub">Countries</div><div class="vl"></div><div class="nn nn-sub">Offers</div><div class="vl"></div><div class="nn nn-sub" style="color:var(--green);border-color:rgba(61,214,140,.4)">Detail+Buy</div></div>
              <div class="branch"><div class="nn nn-sub">Regional</div><div class="vl"></div><div class="nn nn-sub">Regions</div><div class="vl"></div><div class="nn nn-sub">Offers</div><div class="vl"></div><div class="nn nn-sub" style="color:var(--green);border-color:rgba(61,214,140,.4)">Detail+Buy</div></div>
              <div class="branch"><div class="nn nn-sub">Global</div><div class="vl"></div><div class="nn nn-sub" style="color:var(--green);border-color:rgba(61,214,140,.4)">Detail+Buy</div></div>
            </div>
          </div>
          <div class="branch">
            <div class="nn nn-tab" style="color:var(--orange)">Pay</div><div class="vl"></div>
            <div class="branch">
              <div class="nn nn-sub">Countries</div><div class="vl"></div><div class="nn nn-sub">Categories</div><div class="vl"></div><div class="nn nn-sub">Brands</div><div class="vl"></div><div class="nn nn-sub">Offers</div><div class="vl"></div><div class="nn nn-sub" style="color:var(--orange);border-color:rgba(255,171,74,.5)">Detail+Buy</div>
            </div>
          </div>
          <div class="branch"><div class="nn nn-tab" style="color:var(--muted)">Profile</div><div class="vl"></div><div class="nn nn-sub">Settings</div><div class="vl"></div><div class="nn nn-sub">Theme</div></div>
        </div>
      </div>
    </div>
  </div>

  <div class="g2" style="margin-top:32px">
    <div class="card"><div class="card-cat" style="color:var(--purple)">ViewModel in Component</div><div class="card-title">retainedComponent { }</div><div class="card-body">Each Decompose Component creates its ViewModel via <code style="font-family:'JetBrains Mono',monospace;background:rgba(155,114,245,.12);padding:1px 6px;border-radius:3px;font-size:11px">retainedComponent { }</code>. Survives Android config changes and iOS view recreation. No lifecycle wiring needed.</div></div>
    <div class="card"><div class="card-cat" style="color:var(--cyan)">Type-safe Config</div><div class="card-title">Sealed class per Component</div><div class="card-body">Every Component has a sealed class Config listing all child destinations. Navigation is 100% compile-safe â€” no string routes, no runtime crashes from typos.</div></div>
  </div>
</section>


<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â• STACK â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="p-stack" class="panel">
  <p class="sec">Technology Stack</p>
  <div class="tgrid">
    <div class="tc"><div class="tc-cat" style="color:var(--cyan)">Core Framework</div><div class="tc-name">Kotlin Multiplatform</div><div class="tc-purpose">Shared business logic + UI for Android & iOS. androidTarget + iosX64/iosArm64/iosSim.</div><div class="tc-ver">v2.1.0</div></div>
    <div class="tc"><div class="tc-cat" style="color:var(--cyan)">UI</div><div class="tc-name">Compose Multiplatform</div><div class="tc-purpose">Shared declarative UI. One composable tree, rendered natively on Android (Compose) and iOS (Skia).</div><div class="tc-ver">v1.7.0</div></div>
    <div class="tc" style="border-color:rgba(252,211,77,.3)"><div class="tc-cat" style="color:var(--yellow)">Presentation â­</div><div class="tc-name">KMP lifecycle-viewmodel</div><div class="tc-purpose">ViewModel() from org.jetbrains.androidx.lifecycle. No base class. Direct StateFlow + SharedFlow in each VM.</div><div class="tc-ver">v2.9.0</div></div>
    <div class="tc"><div class="tc-cat" style="color:var(--green)">Navigation</div><div class="tc-name">Decompose</div><div class="tc-purpose">Type-safe ChildStack navigation. ViewModel created via retainedComponent{}. Shared in commonMain.</div><div class="tc-ver">v3.1.0</div></div>
    <div class="tc"><div class="tc-cat" style="color:var(--purple)">DI</div><div class="tc-name">Koin</div><div class="tc-purpose">KMP-first, zero-reflection DI. koin-compose provides koinViewModel() in composables.</div><div class="tc-ver">v4.0.0</div></div>
    <div class="tc" style="border-color:rgba(155,114,245,.3)"><div class="tc-cat" style="color:var(--purple)">Build â­</div><div class="tc-name">Build-Logic Convention Plugins</div><div class="tc-purpose">Included build with 6 plugins. Feature modules reduced to ~10 lines of build config.</div><div class="tc-ver">Gradle 8.x</div></div>
    <div class="tc"><div class="tc-cat" style="color:var(--orange)">Networking</div><div class="tc-name">Ktor Client</div><div class="tc-purpose">Async HTTP. OkHttp on Android, Darwin on iOS. Auth, retry, logging interceptors.</div><div class="tc-ver">v2.0.0</div></div>
    <div class="tc"><div class="tc-cat" style="color:var(--orange)">Serialization</div><div class="tc-name">kotlinx.serialization</div><div class="tc-purpose">Compile-time JSON parsing. KMP-first. All DTOs annotated with @Serializable.</div><div class="tc-ver">v1.7.3</div></div>
    <div class="tc"><div class="tc-cat" style="color:var(--green)">Local DB</div><div class="tc-name">SQLDelight 2</div><div class="tc-purpose">Type-safe SQL with Kotlin code generated at compile time. Cache-first offline strategy.</div><div class="tc-ver">v2.0.2</div></div>
    <div class="tc"><div class="tc-cat" style="color:var(--green)">Preferences</div><div class="tc-name">Multiplatform Settings</div><div class="tc-purpose">Key-value storage: ThemeMode, session flags. Wraps SharedPreferences/UserDefaults.</div><div class="tc-ver">v1.2.0</div></div>
    <div class="tc"><div class="tc-cat" style="color:var(--cyan)">Images</div><div class="tc-name">Coil 3</div><div class="tc-purpose">KMP async image loading. Disk + memory cache. Ktor3 network fetcher included.</div><div class="tc-ver">v2.0.4</div></div>
    <div class="tc"><div class="tc-cat" style="color:var(--muted)">Async</div><div class="tc-name">kotlinx.coroutines</div><div class="tc-purpose">viewModelScope, StateFlow.update{}, SharedFlow.emit(). KMP-first.</div><div class="tc-ver">v1.9.0</div></div>
    <div class="tc"><div class="tc-cat" style="color:var(--muted)">Lint</div><div class="tc-name">Detekt</div><div class="tc-purpose">KMP-aware static analysis. Applied via esdiac.detekt convention plugin. Shared baseline.</div><div class="tc-ver">v1.23.7</div></div>
    <div class="tc"><div class="tc-cat" style="color:var(--pink)">VoIP â€” Android</div><div class="tc-name">WebRTC / SIP</div><div class="tc-purpose">Voice engine. Foreground service. DTMF. Behind VoipEngine expect/actual.</div><div class="tc-ver">Platform</div></div>
    <div class="tc"><div class="tc-cat" style="color:var(--pink)">VoIP â€” iOS</div><div class="tc-name">CallKit + WebRTC</div><div class="tc-purpose">Native call UI, PushKit voip notifications, background calling.</div><div class="tc-ver">Platform</div></div>
    <div class="tc"><div class="tc-cat" style="color:var(--orange)">Payments</div><div class="tc-name">Stripe SDK</div><div class="tc-purpose">Tokenized payment. No card data stored locally. PCI DSS scope minimised.</div><div class="tc-ver">Latest</div></div>
    <div class="tc"><div class="tc-cat" style="color:var(--muted)">CI/CD</div><div class="tc-name">GitHub Actions</div><div class="tc-purpose">ubuntu-latest for commonTest + Detekt. macos-latest for iOS. Play + TestFlight on tag release.</div><div class="tc-ver">â€“</div></div>
  </div>
</section>

<footer>
  <span>ESDIAC â€” Architecture v2.0 Â· MVVM (no base class) Â· Build-Logic Convention Plugins</span>
  <span>KMP 2.1 Â· Compose MP 1.7 Â· Android &amp; iOS Â· February 2026</span>
</footer>

<script>
function go(name, btn) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('on'));
  document.querySelectorAll('.tab').forEach(b => b.classList.remove('on'));
  document.getElementById('p-' + name).classList.add('on');
  btn.classList.add('on');
}
</script>
</body>
</html>
